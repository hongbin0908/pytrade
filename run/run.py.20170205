#! /usr/bin/env python3.4
# -*- coding: utf-8 -*-
# @author  Bin Hong

"""
"""

import sys
import os
import platform
import socket
import numpy as np
import pandas as pd
import pickle

import matplotlib
matplotlib.use('Agg')

local_path = os.path.dirname(__file__)
root = os.path.join(local_path, '..')
sys.path.append(root)

from main.work import model
from main.work import build
from main.work import score as score_build
from main.work import bitlize 
from main.work import selected
from main.work import report
#from main.work import pred
from main import base
from main.work.conf import MltradeConf
from main.ta import ta_set
from main.model.spliter import YearSpliter
from main.model import ana
from main.model import feat_select
from main.classifier.tree import MyRandomForestClassifier
from main.classifier.tree import MyLogisticRegressClassifier
from main.classifier.tree import RFCv1n2000md6msl100
from main.classifier.tree import RFCv1n2000md3msl100
from main.classifier.tree import RFCv1n2000md2msl100
from main.classifier.tree import RFCv1n200md2msl100
from main.classifier.tree import RFCv1n2000md6msl10000
from main.classifier.tree import MyGradientBoostingClassifier
from main.classifier.tree import MyBayesClassifier
from main.classifier.tree import MySGDClassifier
from main.work.conf import MyConfStableLTa


if __name__ == '__main__':


    for score in [5,] :
        #confer = MyConfStableLTa(classifier=MySGDClassifier(),score=score)
        #confer = MyConfStableLTa(ta = ta_set.TaSetSma2(),     classifier=MySGDClassifier(),score=score)
        #confer = MyConfStableLTa(classifier=MyGradientBoostingClassifier(),score=score)
        #confer = MyConfStableLTa(classifier = MyLogisticRegressClassifier(max_iter=10), score=score)
        confer = MyConfStableLTa(classifier=RFCv1n2000md6msl100(),score=score)
        build.work(confer)
        score_build.work(confer)
        bitlize.work(confer)
        selected.work(confer)
        confer.force = True
        model.work(confer)
        report.work(confer)
        dfo = pd.read_pickle(confer.get_pred_file())
        df = dfo[(dfo.date >=confer.model_split.test_start)]
        df_sort = df.sort_values('pred', ascending=False)[["date", "sym", "open", "high", "low", "close", "pred"]]
        print(df_sort[df_sort.date == base.get_last_trade_date()].head())
        continue
    #df = df[(df.date >= '2011-01-01')&(df.date<'2012-01-01')]
    #ana.plot_roc(df, confer, os.path.join(root, 'output', "result_20170205_y2011.png"))
    #ana.plot_accurate(df, confer, os.path.join(root, 'output', "result_20170205_y2011_acc.png"))

    #d_feat_ipts = confer.classifier.get_feature_importances(base.get_feat_names(df))
    #df_feat = pd.concat([df_feat[["mi"]], df_ipts], axis=1, join_axes=[df_feat.index])
    #print(df_feat.sort_values("score", ascending=False))
    
    #df = dfo.copy()
    #df_sort = df.sort_values('pred', ascending=False)[["date", "sym", "open", "high", "low", "close", "pred"]]
    #print(df_sort[df_sort.date == base.get_last_trade_date()].head())
